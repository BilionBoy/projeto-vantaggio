<style>
  /* Força cor branca para links de submenus */
  .nav-group-sub .nav-link {
    color: #fff !important;
  }

  /* Cor do ícone dos submenus */
  .nav-group-sub .nav-link i {
    color: #fff !important;
  }

  /* Hover dos submenus */
  .nav-group-sub .nav-link:hover {
    background-color: rgba(255,255,255,0.1);
  }
</style>
<div class="sidebar sidebar-dark sidebar-main sidebar-expand-xl" style="background: linear-gradient(135deg, #317a6cff 0%, #44A08D 100%)">
  <div class="sidebar-content">
    <div class="sidebar-section-body">
      <div class="form-control-feedback form-control-feedback-end">
        <input type="search" id="sidebar-search-input" class="form-control" placeholder="Pesquisar" onkeyup="filterSidebar()">
        <div class="form-control-feedback-icon">
          <i class="ph-magnifying-glass opacity-50"></i>
        </div>
      </div>
    </div>
    <div class="sidebar-section">
      <ul class="nav nav-sidebar" data-nav-type="accordion" id="sidebar-items">
        <% SidebarMenu.items.each do |item| %>
            <% if item[:submenu] %>
              <% visible_subitems = item[:submenu].select { |sub| sub[:roles].nil? || sub[:roles].include?(current_user.role&.name) } %>
              <% next if visible_subitems.empty? %>
              <li class="nav-item nav-item-submenu">
                <a href="#" class="nav-link">
                  <i class="<%= item[:icon] %>"></i>
                  <span><%= item[:name] %></span>
                </a>
                <ul class="nav-group-sub collapse">
                  <% visible_subitems.each do |sub| %>
                    <li class="nav-item">
                      <%= link_to t(sub[:name]), sub[:path].is_a?(Proc) ? instance_exec(&sub[:path]) : send(sub[:path]), class: "nav-link" %>
                    </li>
                  <% end %>
                </ul>
              </li>
            <% else %>
              <li class="nav-item">
                <%= link_to send(item[:path]), class: "nav-link" do %>
                  <i class="<%= item[:icon] %>"></i>
                  <span><%= item[:name] %></span>
                <% end %>
              </li>
            <% end %>
        <% end %>
      </ul>
    </div>
  </div>
</div>
<script>
  function filterSidebar() {
    const input = document.getElementById("sidebar-search-input");
    const filter = input.value.toLowerCase().trim();
    const items = document.querySelectorAll("#sidebar-items > li");
    if (filter === "") {
      items.forEach(item => {
        item.style.display = "";
        const submenu = item.querySelector(".nav-group-sub");
        if (submenu) {
          submenu.classList.remove("show");
          submenu.querySelectorAll("li.nav-item").forEach(sub => sub.style.display = "");
        }
      });
      return;
    }
    items.forEach(item => {
      const linkText = item.textContent.toLowerCase();
      const submenu = item.querySelector(".nav-group-sub");

      if (submenu) {
        const subitems = submenu.querySelectorAll("li.nav-item");
        let matchFound = false;

        subitems.forEach(sub => {
          const text = sub.textContent.toLowerCase();
          const visible = text.includes(filter);
          sub.style.display = visible ? "" : "none";
          if (visible) matchFound = true;
        });

        if (matchFound || linkText.includes(filter)) {
          item.style.display = "";
          submenu.classList.add("show");
        } else {
          item.style.display = "none";
          submenu.classList.remove("show");
        }
      } else {
        item.style.display = linkText.includes(filter) ? "" : "none";
      }
    });
  }
</script>
